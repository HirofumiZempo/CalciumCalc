<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>カルシウム摂取チェック</title>
<style>
  :root{
    --bg:#0f172a;            /* slate-900 */
    --card:#0b1227;          /* slightly lighter */
    --accent:#60a5fa;        /* blue-400 */
    --accent-2:#93c5fd;      /* blue-300 */
    --text:#e5e7eb;          /* gray-200 */
    --muted:#9ca3af;         /* gray-400 */
    --border:#1f2937;        /* gray-800 */
    --ok:#34d399;            /* emerald-400 */
    --warn:#fbbf24;          /* amber-400 */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background: radial-gradient(1200px 800px at 80% -10%, #1e293b 0%, #0b1227 45%, #0b1227 60%, #0f172a 100%),
               linear-gradient(180deg, #0f172a, #0b1227 30%, #0f172a);
    color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  .wrap{
    max-width:960px; margin:48px auto; padding:0 20px;
  }
  .card{
    background:rgba(11,18,39,.6);
    border:1px solid var(--border);
    backdrop-filter: blur(8px);
    border-radius:20px;
    box-shadow: 0 20px 60px rgba(0,0,0,.35);
    overflow:hidden;
  }
  .head{
    padding:26px 28px;
    background:linear-gradient(135deg, rgba(96,165,250,.18), rgba(52,211,153,.08));
    border-bottom:1px solid var(--border);
  }
  .title{margin:0; font-size:22px; letter-spacing:.2px}
  .sub{margin:6px 0 0; color:var(--muted); font-size:14px}
  .body{padding:22px 22px 8px}
  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:14px;
  }
  @media (max-width: 820px){
    .grid{grid-template-columns:1fr}
  }
  .field{
    padding:14px;
    border:1px solid var(--border);
    border-radius:14px;
    background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
  }
  .label{
    display:block; font-size:18px; color:var(--muted); margin-bottom:8px;
  }
  select{
    width:100%;
    padding:12px 14px;
    border-radius:10px;
    border:1px solid var(--border);
    background:
      linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,2)) padding-box,
      linear-gradient(135deg, rgba(96,165,250,.45), rgba(52,211,153,.25)) border-box;
    color:blue;
    appearance:none;
    outline:none;
    position:relative;
    font-size:15px;
  }
  .select-wrap{position:relative}
  .select-wrap:after{
    content:"";
    position:absolute; right:12px; top:50%; transform:translateY(-50%);
    width:0; height:0; border-left:6px solid transparent; border-right:6px solid transparent; border-top:8px solid var(--accent-2);
    pointer-events:none;
  }
  .btn-row{display:flex; gap:10px; flex-wrap:wrap; margin:18px 0 8px}
  .btn{
    padding:12px 16px; border-radius:12px; border:1px solid var(--border);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
    color:var(--text); cursor:pointer; font-weight:600; letter-spacing:.2px;
    transition:.2s transform ease, .2s background ease, .2s opacity ease;
  }
  .btn:hover{transform:translateY(-1px)}
  .btn-primary{
    border-color: transparent;
    background:
      linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,0)) padding-box,
      linear-gradient(135deg, var(--accent), var(--ok)) border-box;
    font-size: 18px; /* 「合計を表示」ボタンのフォントを調整*/
  }
  .hint{font-size:13px; color:var(--muted)}
  .foot{padding:12px 22px 22px}

  /* Modal */
  .modal-backdrop{
    position:fixed; inset:0; background:rgba(2,6,23,.65);
    display:none; align-items:center; justify-content:center; z-index:50;
  }
  .modal{
    width:min(560px, calc(100% - 28px));
    background:#0c1226;
    border:1px solid var(--border); border-radius:18px;
    box-shadow:0 30px 80px rgba(0,0,0,.55);
    overflow:hidden;
  }
  .modal-h{
    padding:18px 20px; border-bottom:1px solid var(--border);
    background:linear-gradient(135deg, rgba(96,165,250,.18), rgba(52,211,153,.08));
  }
  .modal-t{margin:0; font-size:18px}
  .modal-b{padding:20px}
  .total{
    display:flex; align-items:baseline; gap:10px; flex-wrap:wrap;
    margin:4px 0 8px;
  }
  .total strong{font-size:32px; line-height:1}
  .meter{width:100%; height:14px; background:#0a1020; border:1px solid var(--border); border-radius:999px; overflow:hidden}
  .bar{height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--ok)); transition:width .4s ease}
  .note{font-size:12px; color:var(--muted); margin-top:6px}
  .advice{
    margin-top:14px; padding:12px; border-radius:12px; border:1px dashed var(--border); color:#fef3c7; background:rgba(251,191,36,.06);
  }
  .modal-f{
    display:flex; gap:10px; justify-content:flex-end; padding:14px 16px; border-top:1px solid var(--border); background:rgba(255,255,255,.02)
  }
  .ghost{opacity:.8}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <h1 class="title">カルシウム摂取チェック</h1>
        <p class="sub">各設問を選択し、「合計を表示」を押すと、合計の総量（mg）を表示します。</p>
      </div>

      <div class="body">
        <form id="form">
          <div class="grid" id="qgrid"><!-- JS render --></div>
          <div class="btn-row">
            <button class="btn btn-primary" type="button" id="calcBtn">合計を表示</button>
            <button class="btn" type="button" id="resetBtn">リセット</button>
          </div>
        </form>
      </div>
      <div class="foot">
        <div class="hint">石井ら. Osteoporosis Japan 2005 13:497-502.を改編</div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="backdrop" role="dialog" aria-modal="true" aria-labelledby="mtitle">
    <div class="modal">
      <div class="modal-h">
        <h2 class="modal-t" id="mtitle">結果</h2>
      </div>
      <div class="modal-b">
        <div class="total">
          <span>合計</span>
          <strong><span id="totalMg">0</span> mg</strong>
        </div>
        <div class="meter"><div id="bar" class="bar"></div></div>
        <div class="note" id="meterNote">最大値（1600 mg = 100%）</div>
        <div class="advice" id="advice" style="display:none;"></div>
      </div>
      <div class="modal-f">
        <button class="btn ghost" type="button" id="closeBtn">閉じる</button>
        <button class="btn btn-primary" type="button" id="againBtn">もう一度行う</button>
      </div>
    </div>
  </div>

<script>
  // ===== 設定 =====
  const METER_MAX = 1600; // メーター100%基準
  const LOW_THRESHOLD = 600; // 注意喚起の閾値

  const QUESTIONS = [
    { id:'q1', label:'1) 牛乳（どのくらい飲みますか？）', options:[
      {t:'選択してください', mg:''}, {t:'ほとんど飲まない', mg:0}, {t:'月1−2回', mg:20},
      {t:'週1−2回', mg:40}, {t:'週3−4回', mg:80}, {t:'ほとんど毎日', mg:160}
    ]},
    { id:'q2', label:'2) ヨーグルト', options:[
      {t:'選択してください', mg:''}, {t:'ほとんど食べない', mg:0}, {t:'週1−2回', mg:20},
      {t:'週3−4回', mg:40}, {t:'ほとんど毎日', mg:80}, {t:'毎日2個', mg:160}
    ]},
    { id:'q3', label:'3) 乳製品（チーズ等）やスキムミルク', options:[
      {t:'選択してください', mg:''}, {t:'ほとんど食べない', mg:0}, {t:'週1−2回', mg:20},
      {t:'週3−4回', mg:40}, {t:'ほとんど毎日', mg:80}, {t:'毎日2種以上', mg:160}
    ]},
    { id:'q4', label:'4) 大豆、納豆など豆類', options:[
      {t:'選択してください', mg:''}, {t:'ほとんど食べない', mg:0}, {t:'週1−2回', mg:20},
      {t:'週3−4回', mg:40}, {t:'ほとんど毎日', mg:80}, {t:'毎日2種以上', mg:160}
    ]},
    { id:'q5', label:'5) 豆腐、がんも、厚揚げなど大豆製品', options:[
      {t:'選択してください', mg:''}, {t:'ほとんど食べない', mg:0}, {t:'週1−2回', mg:20},
      {t:'週3−4回', mg:40}, {t:'ほとんど毎日', mg:80}, {t:'毎日2種以上', mg:160}
    ]},
    { id:'q6', label:'6) 青菜（ホウレン草・小松菜・チンゲン菜）', options:[
      {t:'選択してください', mg:''}, {t:'ほとんど食べない', mg:0}, {t:'週1−2回', mg:20},
      {t:'週3−4回', mg:40}, {t:'ほとんど毎日', mg:80}, {t:'毎日2種以上', mg:160}
    ]},
    { id:'q7', label:'7) 海藻類（わかめ・あおさ・のり等）', options:[
      {t:'選択してください', mg:''}, {t:'ほとんど食べない', mg:0}, {t:'週1−2回', mg:20},
      {t:'週3−4回', mg:40}, {t:'ほとんど毎日', mg:80} // 160mg 欄は無しの想定
    ]},
    { id:'q8', label:'8) 骨ごと食べられる魚（シシャモ・いわし）', options:[
      {t:'選択してください', mg:''}, {t:'ほとんど食べない', mg:0}, {t:'月1−2回', mg:20},
      {t:'週1−2回', mg:40}, {t:'週3−4回', mg:80}, {t:'ほとんど毎日', mg:160}
    ]},
    { id:'q9', label:'9) 小魚（しらす・ほしエビなど）', options:[
      {t:'選択してください', mg:''}, {t:'ほとんど食べない', mg:0}, {t:'週1−2回', mg:20},
      {t:'週3−4回', mg:40}, {t:'ほとんど毎日', mg:80}, {t:'毎日2種以上', mg:160}
    ]},
    { id:'q10', label:'10) 朝食・昼食・夕食の1日3食', options:[
      {t:'選択してください', mg:''}, {t:'1日2食', mg:20}, {t:'欠食が多い', mg:80}, {t:'1日3食', mg:160}
    ]},
  ];

  // ===== レンダリング =====
  const qgrid = document.getElementById('qgrid');
  QUESTIONS.forEach(q=>{
    const f = document.createElement('div');
    f.className = 'field';
    const l = document.createElement('label');
    l.className = 'label'; l.textContent = q.label;
    const wrap = document.createElement('div'); wrap.className='select-wrap';
    const s = document.createElement('select'); s.name = q.id; s.id = q.id; s.required = true;
    q.options.forEach(opt=>{
      const o = document.createElement('option');
      o.textContent = opt.t;
      o.value = opt.mg; // '' or number
      if(opt.mg==='') { o.selected = true; o.disabled = true; }
      s.appendChild(o);
    });
    wrap.appendChild(s);
    f.appendChild(l); f.appendChild(wrap);
    qgrid.appendChild(f);
  });

  // ===== ロジック =====
  const calcBtn = document.getElementById('calcBtn');
  const resetBtn = document.getElementById('resetBtn');

  const backdrop = document.getElementById('backdrop');
  const closeBtn = document.getElementById('closeBtn');
  const againBtn = document.getElementById('againBtn');

  const totalMgEl = document.getElementById('totalMg');
  const barEl = document.getElementById('bar');
  const noteEl = document.getElementById('meterNote');
  const adviceEl = document.getElementById('advice');

  noteEl.textContent = `メーター最大値 = ${METER_MAX} mg`;

  function allAnswered(){
    return QUESTIONS.every(q=>{
      const v = document.getElementById(q.id).value;
      return v !== '';
    });
  }
  function computeTotal(){
    let sum = 0;
    QUESTIONS.forEach(q=>{
      sum += Number(document.getElementById(q.id).value || 0);
    });
    return sum;
  }
  function openModal(){
    backdrop.style.display = 'flex';
  }
  function closeModal(){
    backdrop.style.display = 'none';
  }
  function resetAll(){
    QUESTIONS.forEach(q=>{
      const sel = document.getElementById(q.id);
      sel.selectedIndex = 0; // placeholder
    });
  }
  function updateModal(total){
    totalMgEl.textContent = total;
    const pct = Math.max(0, Math.min(100, Math.round(total / METER_MAX * 100)));
    barEl.style.width = pct + '%';
    // アドバイス
    if (total < LOW_THRESHOLD){
      adviceEl.style.display = 'block';
      adviceEl.textContent = '合計が基準に満たない可能性があります。乳製品・小魚・青菜などを意識して取り入れると改善が期待できます。';
    } else {
      adviceEl.style.display = 'block';
      adviceEl.textContent = 'この調子を維持しましょう。'; // ← コメント本文
    }
  }

  calcBtn.addEventListener('click', ()=>{
    if(!allAnswered()){
      alert('すべての設問で選択してください。');
      return;
    }
    const total = computeTotal();
    updateModal(total);
    openModal();
  });
  resetBtn.addEventListener('click', resetAll);
  closeBtn.addEventListener('click', closeModal);
  backdrop.addEventListener('click', (e)=>{ if(e.target === backdrop) closeModal(); });
  againBtn.addEventListener('click', ()=>{ resetAll(); closeModal(); });

  // キーボード操作（Escで閉じる）
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });
</script>
</body>
</html>
